# 🚨 VPN 代理配置 - 重要说明

## 问题原因

你的 VPN **没有对 Node.js 生效**！虽然浏览器可以访问 Google，但 Node.js 服务器无法通过 VPN 连接到 Google API。

## ✅ 解决方案

### 第 1 步：找到你的 VPN 代理端口

打开你的 VPN 软件，找到**本地代理端口**设置：

#### Clash
- 打开 Clash → 设置 → 端口设置
- 查看 "HTTP 代理端口" 或 "混合端口"
- **通常是：7890**

#### V2RayN
- 打开 V2RayN → 参数设置 → 本地监听端口
- 查看 "HTTP 代理"
- **通常是：10809**

#### Shadowsocks
- 右键托盘图标 → 服务器
- 查看 "本地端口"
- **通常是：1080**

### 第 2 步：修改启动脚本

1. 用记事本打开 `start-with-proxy.bat`
2. 找到这一行：
   ```batch
   set PROXY_PORT=7890
   ```
3. 修改 `7890` 为你的 VPN 端口号
4. 保存文件

### 第 3 步：使用新脚本启动

1. **双击运行 `start-with-proxy.bat`**
2. 等待启动完成
3. 在浏览器访问 `http://localhost:3000`
4. 测试图片生成功能

## 📝 快速测试

### 测试 1：VPN 是否工作
在浏览器打开：
```
https://www.google.com
```
如果能打开，说明 VPN 工作正常。

### 测试 2：代理端口是否正确
在命令提示符中运行：
```cmd
curl -I --proxy http://127.0.0.1:7890 https://www.google.com
```
（把 7890 改成你的端口）

如果返回 `HTTP/2 200`，说明代理端口正确。

## ⚙️ 不知道端口号？

### 方法 1：查看 VPN 设置
大部分 VPN 软件在"设置"或"偏好设置"中都有端口配置。

### 方法 2：常见端口尝试
依次尝试这些常见端口：
- `7890` (Clash)
- `10809` (V2RayN)
- `1080` (Shadowsocks)
- `7891`
- `10808`

修改 `start-with-proxy.bat` 中的端口号，重新运行。

### 方法 3：直接告诉我
告诉我你用的 VPN 软件名称，我帮你查找正确的端口。

## 🎯 成功标志

当使用 `start-with-proxy.bat` 启动后，应该看到：

```
[1/3] 设置代理环境变量...
代理设置: http://127.0.0.1:7890

[2/3] 测试代理连接...
✓ 代理连接正常  ← 这里应该显示成功

[3/3] 启动服务器...
===========================================
专业头像生成器服务已启动
服务地址: http://localhost:3000
API Key 已配置: 是
使用模型: gemini-2.5-flash-image
===========================================
```

然后测试图片生成，服务器日志应该显示：
```
API 响应状态码: 200  ← 而不是 ETIMEDOUT
```

## ❌ 如果还是失败

### 检查清单：
- [ ] VPN 已连接（能访问 google.com）
- [ ] 代理端口号正确
- [ ] VPN 设置中启用了"允许来自局域网的连接"
- [ ] 使用 `start-with-proxy.bat` 启动（而不是 `npm start`）

### 仍然不行？
告诉我：
1. 你的 VPN 软件名称
2. VPN 设置截图（端口设置部分）
3. 或者 VPN 的完整设置信息

我可以根据你的具体情况提供精确的配置。

---

## 📋 总结

**问题**：VPN 只对浏览器生效，Node.js 无法使用 VPN
**解决**：通过环境变量配置代理，让 Node.js 使用 VPN 的本地代理端口

**现在要做的**：
1. 找到 VPN 代理端口
2. 修改 `start-with-proxy.bat` 中的端口号
3. 双击运行 `start-with-proxy.bat`
4. 测试图片生成功能
